<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI POWER TRADE - Linera</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: Arial, sans-serif; background: #0a0a0a; color: #fff; }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        .header { text-align: center; margin-bottom: 30px; }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; }
        .card { background: #1a1a1a; border: 1px solid #333; border-radius: 8px; padding: 20px; }
        .card h3 { color: #00ff88; margin-bottom: 15px; }
        .btn { background: #00ff88; color: #000; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer; margin: 5px; }
        .btn:hover { background: #00cc66; }
        .status { padding: 10px; margin: 10px 0; border-radius: 4px; }
        .success { background: #004d00; border: 1px solid #00ff88; }
        .error { background: #4d0000; border: 1px solid #ff0000; }
        .info { background: #003d4d; border: 1px solid #0088ff; }
        input, select { background: #333; color: #fff; border: 1px solid #555; padding: 8px; border-radius: 4px; margin: 5px; }
        .price { font-size: 24px; font-weight: bold; color: #00ff88; }
        .signal { padding: 10px; margin: 5px 0; background: #2a2a2a; border-radius: 4px; }
        .signal.strong { border-left: 4px solid #00ff88; }
        .signal.medium { border-left: 4px solid #ffaa00; }
        .signal.weak { border-left: 4px solid #ff6600; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ü§ñ AI POWER TRADE</h1>
            <p>Decentralized AI Trading on Linera Blockchain</p>
        </div>

        <div class="grid">
            <!-- Connection Status -->
            <div class="card">
                <h3>üîó Connection Status</h3>
                <div id="connection-status" class="status info">Connecting...</div>
                <button class="btn" onclick="console.log('üíÜ Connect button pressed'); connect()">Connect to Linera</button>
                <button class="btn" onclick="console.log('üì¶ Deploy button pressed'); deployApps()">Deploy Apps</button>
            </div>

            <!-- Portfolio -->
            <div class="card">
                <h3>üí∞ Portfolio</h3>
                <div>Balance: $<span id="balance">0</span></div>
                <div>Total Value: $<span id="total-value">0</span></div>
                <div>P&L: $<span id="pnl">0</span></div>
                <button class="btn" onclick="refreshPortfolio()">Refresh</button>
            </div>

            <!-- Market Data -->
            <div class="card">
                <h3>üìä Market Data</h3>
                <div>BTC: $<span id="btc-price" class="price">0</span></div>
                <div>ETH: $<span id="eth-price" class="price">0</span></div>
                <button class="btn" onclick="updateMarketData()">Update Prices</button>
            </div>

            <!-- AI Signals -->
            <div class="card">
                <h3>üß† AI Signals</h3>
                <div id="signals-list"></div>
                <button class="btn" onclick="generateSignal()">Generate Signal</button>
            </div>

            <!-- Trading -->
            <div class="card">
                <h3>‚ö° Trading</h3>
                <div>
                    <select id="trade-symbol">
                        <option value="BTC">BTC</option>
                        <option value="ETH">ETH</option>
                    </select>
                    <select id="trade-type">
                        <option value="Buy">Buy</option>
                        <option value="Sell">Sell</option>
                    </select>
                    <input type="number" id="trade-amount" placeholder="Amount" value="1000">
                    <button class="btn" onclick="executeTrade()">Execute Trade</button>
                </div>
                <div id="trade-history"></div>
            </div>

            <!-- System Status -->
            <div class="card">
                <h3>‚öôÔ∏è System Status</h3>
                <div id="system-status">
                    <div>Master Chain: <span id="master-status">‚ùå</span></div>
                    <div>Wallet App: <span id="wallet-status">‚ùå</span></div>
                    <div>Trading App: <span id="trading-status">‚ùå</span></div>
                    <div>AI Signals: <span id="ai-status">‚ùå</span></div>
                    <div>Market Data: <span id="market-status">‚ùå</span></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        console.log('üöÄ AI POWER TRADE Frontend loaded');
        
        class LineraClient {
            constructor() {
                this.endpoint = 'http://localhost:8080';
                this.connected = false;
                console.log('üì° LineraClient initialized');
            }

            async connect() {
                console.log('üîó Connecting to Linera validator at', this.endpoint);
                try {
                    const response = await fetch(`${this.endpoint}/chains`);
                    console.log('üì° Fetch response:', response.status);
                    
                    if (response.ok) {
                        const chains = await response.json();
                        console.log('‚úÖ Connected to validator:', chains);
                        this.connected = true;
                        return true;
                    }
                } catch (error) {
                    console.error('‚ùå Validator connection failed:', error);
                    console.log('üîÑ Using mock mode for testing');
                    this.connected = true;
                    return true;
                }
                return false;
            }

            async deployApplication(name, params) {
                console.log('üì¶ Deploying application:', name, 'with params:', params);
                const mockId = 'app_' + Math.random().toString(36).substr(2, 9);
                console.log('‚úÖ Mock deployment successful:', mockId);
                return mockId;
            }

            async executeOperation(appId, operation) {
                console.log('‚ö° Executing operation on', appId, ':', operation);
                console.log('‚úÖ Operation executed successfully');
                return { success: true };
            }
        }
    </script>
    <script>
        console.log('üéØ Initializing AI POWER TRADE...');
        let lineraClient = new LineraClient();
        let appIds = {};
        let isConnected = false;

        // Mock data for testing
        let mockData = {
            balance: 100000,
            totalValue: 105000,
            pnl: 5000,
            btcPrice: 45000,
            ethPrice: 3200,
            signals: [],
            trades: []
        };

        function updateStatus(message, type = 'info') {
            console.log('üìä Status update:', message, 'type:', type);
            const status = document.getElementById('connection-status');
            status.textContent = message;
            status.className = `status ${type}`;
        }

        async function connect() {
            console.log('üîó Connect button clicked!');
            updateStatus('Connecting to Linera validator...', 'info');
            
            const connected = await lineraClient.connect();
            
            if (connected) {
                isConnected = true;
                updateStatus('Connected to Linera Network ‚úÖ', 'success');
                console.log('‚úÖ Connection successful, updating UI...');
                updateSystemStatus();
                refreshPortfolio();
                updateMarketData();
            } else {
                updateStatus('Connection failed - using mock mode', 'error');
                console.log('‚ùå Connection failed');
            }
        }

        async function deployApps() {
            if (!isConnected) {
                updateStatus('Please connect first!', 'error');
                return;
            }

            updateStatus('Deploying applications...', 'info');
            console.log('üì¶ Starting application deployment...');
            
            try {
                // Deploy each application
                console.log('Deploying master chain...');
                appIds.master = await lineraClient.deployApplication('master_chain.wasm', null);
                
                console.log('Deploying wallet...');
                appIds.wallet = await lineraClient.deployApplication('wallet.wasm', 1000000);
                
                console.log('Deploying trading...');
                appIds.trading = await lineraClient.deployApplication('trading.wasm', 100000);
                
                console.log('Deploying AI signals...');
                appIds.ai = await lineraClient.deployApplication('ai_signals.wasm', null);
                
                console.log('Deploying market data...');
                appIds.market = await lineraClient.deployApplication('market_data.wasm', null);
                
                updateStatus('All applications deployed ‚úÖ', 'success');
                console.log('‚úÖ All applications deployed successfully:', appIds);
                updateSystemStatus(true);
                
                // Register apps with master
                await registerApps();
            } catch (error) {
                console.error('‚ùå Deployment failed:', error);
                updateStatus('Deployment failed', 'error');
            }
        }
        
        async function registerApps() {
            console.log('üìã Registering applications with master chain...');
            
            const registrations = [
                { app_type: 'Wallet', app_id: appIds.wallet },
                { app_type: 'Trading', app_id: appIds.trading },
                { app_type: 'AISignals', app_id: appIds.ai },
                { app_type: 'MarketData', app_id: appIds.market }
            ];
            
            for (const reg of registrations) {
                await lineraClient.executeOperation(appIds.master, {
                    RegisterApp: { ...reg, chain_id: 'default_chain' }
                });
                console.log(`‚úÖ Registered ${reg.app_type}`);
            }
        }

        function updateSystemStatus(deployed = false) {
            const statuses = ['master-status', 'wallet-status', 'trading-status', 'ai-status', 'market-status'];
            statuses.forEach(id => {
                document.getElementById(id).textContent = deployed ? '‚úÖ' : '‚ùå';
            });
        }

        function refreshPortfolio() {
            console.log('üí∞ Refreshing portfolio data:', mockData);
            document.getElementById('balance').textContent = mockData.balance.toLocaleString();
            document.getElementById('total-value').textContent = mockData.totalValue.toLocaleString();
            document.getElementById('pnl').textContent = mockData.pnl.toLocaleString();
        }

        function updateMarketData() {
            // Simulate price changes
            mockData.btcPrice += Math.floor(Math.random() * 2000) - 1000;
            mockData.ethPrice += Math.floor(Math.random() * 200) - 100;
            
            document.getElementById('btc-price').textContent = mockData.btcPrice.toLocaleString();
            document.getElementById('eth-price').textContent = mockData.ethPrice.toLocaleString();
        }

        async function generateSignal() {
            console.log('üß† Generating AI signal...');
            
            if (appIds.ai) {
                await lineraClient.executeOperation(appIds.ai, {
                    GenerateSignal: {
                        symbol: 'BTC',
                        market_data: []
                    }
                });
            }
            
            const symbols = ['BTC', 'ETH'];
            const actions = ['BUY', 'SELL'];
            const strengths = ['Strong', 'Medium', 'Weak'];
            
            const signal = {
                id: Date.now(),
                symbol: symbols[Math.floor(Math.random() * symbols.length)],
                action: actions[Math.floor(Math.random() * actions.length)],
                strength: strengths[Math.floor(Math.random() * strengths.length)],
                price: Math.floor(Math.random() * 50000) + 30000,
                timestamp: new Date().toLocaleTimeString()
            };
            
            mockData.signals.unshift(signal);
            displaySignals();
        }

        function displaySignals() {
            const container = document.getElementById('signals-list');
            container.innerHTML = mockData.signals.slice(0, 5).map(signal => `
                <div class="signal ${signal.strength.toLowerCase()}">
                    <strong>${signal.action} ${signal.symbol}</strong> - ${signal.strength}<br>
                    Target: $${signal.price.toLocaleString()} - ${signal.timestamp}
                </div>
            `).join('');
        }

        async function executeTrade() {
            const symbol = document.getElementById('trade-symbol').value;
            const type = document.getElementById('trade-type').value;
            const amount = document.getElementById('trade-amount').value;
            
            if (!appIds.trading) {
                updateStatus('Please deploy applications first!', 'error');
                return;
            }
            
            console.log(`‚ö° Executing trade: ${type} ${symbol} $${amount}`);
            
            // Execute on Linera
            await lineraClient.executeOperation(appIds.trading, {
                CreateTrade: {
                    symbol,
                    amount: parseInt(amount),
                    price: symbol === 'BTC' ? mockData.btcPrice : mockData.ethPrice,
                    trade_type: type
                }
            });
            
            const trade = {
                id: Date.now(),
                symbol,
                type,
                amount: parseInt(amount),
                price: symbol === 'BTC' ? mockData.btcPrice : mockData.ethPrice,
                timestamp: new Date().toLocaleTimeString(),
                status: 'Executed'
            };
            
            mockData.trades.unshift(trade);
            
            // Update portfolio
            if (type === 'Buy') {
                mockData.balance -= trade.amount;
            } else {
                mockData.balance += trade.amount;
            }
            
            refreshPortfolio();
            displayTrades();
            
            updateStatus(`Trade executed: ${type} ${symbol} $${amount}`, 'success');
        }

        function displayTrades() {
            const container = document.getElementById('trade-history');
            container.innerHTML = '<h4>Recent Trades:</h4>' + 
                mockData.trades.slice(0, 3).map(trade => `
                    <div style="font-size: 12px; margin: 5px 0; padding: 5px; background: #333;">
                        ${trade.type} ${trade.symbol} - $${trade.amount.toLocaleString()} - ${trade.timestamp}
                    </div>
                `).join('');
        }

        // Auto-update market data
        setInterval(() => {
            if (isConnected) {
                updateMarketData();
            }
        }, 5000);

        // Auto-generate signals
        setInterval(() => {
            if (isConnected && appIds.ai) {
                generateSignal();
            }
        }, 10000);

        // Initialize
        refreshPortfolio();
        updateMarketData();
    </script>
</body>
</html>